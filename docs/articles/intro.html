<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to facerec â€¢ facerec</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to facerec">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">facerec</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to facerec</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/methodds/facerec">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to facerec</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/methodds/facerec/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div id="an-interface-for-face-recognition-in-r" class="section level1">
<h1 class="hasAnchor">
<a href="#an-interface-for-face-recognition-in-r" class="anchor"></a>An Interface for Face Recognition in R</h1>
<p>The facerec package provides an interface to the <a href="https://www.kairos.com/docs/api/">Kairos Face Recognition API</a>. The API detects faces in images and returns estimates for demographics. It is also capable of recognizing and verifying humans across several images.</p>
<div id="how-to-install" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-install" class="anchor"></a>How to Install</h2>
<p>To install the CRAN version of facerec use <code>install.packages('facerec')</code>.</p>
<p>You can also download and install the latest development version of the app by running <code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github('methodds/facerec')</a></code>. For Windows users installing from github requires proper setup of <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a>, for which a tutorial is available <a href="https://github.com/stan-dev/rstan/wiki/Install-Rtools-for-Windows">here</a>.</p>
</div>
<div id="how-to-use" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-use" class="anchor"></a>How to Use</h2>
<div id="authentification" class="section level3">
<h3 class="hasAnchor">
<a href="#authentification" class="anchor"></a>Authentification</h3>
<p>After loading facerec you first need to initiate your authentification credentials. Kairos offers a <a href="https://www.kairos.com/pricing">free trial</a> for API access. After signing up, you will receive an application id and an application key. Both credentials need to be set as environment variables before using the initialization function <code><a href="../reference/facerec_init.html">facerec_init()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">Sys.setenv</span>(<span class="dt">kairos_id =</span> <span class="st">"Your Kairos API id"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">Sys.setenv</span>(<span class="dt">kairos_key =</span> <span class="st">"Your Kairos API key"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(facerec)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="../reference/facerec_init.html">facerec_init</a></span>()</a></code></pre></div>
<p>You only need to call <code><a href="../reference/facerec_init.html">facerec_init()</a></code> once after loading the package. In order to avoid entering your credentials for each session, you can permanently store them in your <code>.Renviron</code>. I recommend <code><a href="http://www.rdocumentation.org/packages/usethis/topics/edit">usethis::edit_r_environ()</a></code> to find and edit your environment file.</p>
</div>
<div id="face-recognition" class="section level3">
<h3 class="hasAnchor">
<a href="#face-recognition" class="anchor"></a>Face Recognition</h3>
<p>The Kairos API accepts images of file type JPG, PNG, or BMP. Images can be passed to several facerec functions, either as an url string or a local image prepared with <code><a href="../reference/prep_image.html">prep_image()</a></code>. In the following example, <code><a href="../reference/detect.html">detect()</a></code> is used to recognize the face of the Star Wars character <a href="https://en.wikipedia.org/wiki/Finn_(Star_Wars)">Finn</a>:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/en/2/2a/Finn-Force_Awakens_%282015%29.png" width="300"></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">finn_image &lt;-<span class="st"> 'https://upload.wikimedia.org/wikipedia/en/2/2a/Finn-Force_Awakens_%282015%29.png'</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">finn_face &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect.html">detect</a></span>(<span class="dt">image =</span> finn_image)</a></code></pre></div>
<p>The function returns a dataframe with annotations for the recognized faces in the input image. Variables include positional features of faces, such as x and y coordinates for eyes. Moreover, demographic attributes like gender, ethnicity and age are available.</p>
<p>Features can be visualized with the packages magick and ggplot2:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(magick)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"> finn_image <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">image_read</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">image_ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">   </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> finn_face, </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">             <span class="kw">aes</span>(<span class="dt">xmin =</span> top_left_x, <span class="dt">xmax =</span> top_left_x <span class="op">+</span><span class="st"> </span>width, </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">                 <span class="dt">ymin =</span> top_left_y, <span class="dt">ymax =</span> top_left_y <span class="op">+</span><span class="st"> </span>height),</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">             <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">linetype =</span> <span class="st">'dashed'</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">'#377eb8'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">   </span><span class="kw">geom_label</span>(<span class="dt">data =</span> finn_face,</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">             <span class="kw">aes</span>(<span class="dt">x =</span> chin_tip_x, <span class="dt">y =</span> chin_tip_y <span class="op">+</span><span class="st"> </span><span class="dv">20</span>, </a>
<a class="sourceLine" id="cb4-12" data-line-number="12">                 <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">'Gender:'</span>, </a>
<a class="sourceLine" id="cb4-13" data-line-number="13">                               <span class="kw">percent</span>(face_gender_male_confidence),</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">                 <span class="st">'Male'</span>)), <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">color =</span> <span class="st">'#377eb8'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="st">   </span><span class="kw">geom_label</span>(<span class="dt">data =</span> finn_face,</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">             <span class="kw">aes</span>(<span class="dt">x =</span> chin_tip_x, <span class="dt">y =</span> chin_tip_y <span class="op">+</span><span class="st"> </span><span class="dv">60</span>, </a>
<a class="sourceLine" id="cb4-17" data-line-number="17">                 <span class="dt">label =</span> <span class="kw">paste</span>(<span class="st">'Ethnicity:'</span>, <span class="kw">percent</span>(face_black),</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">                 <span class="st">'Black'</span>)), <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">color =</span> <span class="st">'#377eb8'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="st">   </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a></code></pre></div>
<p><img src="../man/figures/finn_facerec.png" width="400"></p>
<p>Kairos has <a href="https://www.kairos.com/docs/api/best-practices">some recommendations</a> for improving the quality of its recognition service, but in general, the API also works with multiple faces inside an image:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">sw_img &lt;-<span class="st"> "https://upload.wikimedia.org/wikipedia/en/8/82/Leiadeathstar.jpg"</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">sw_faces &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detect.html">detect</a></span>(sw_img)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">sw_img <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">image_read</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">image_ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">   </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> sw_faces, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">             <span class="kw">aes</span>(<span class="dt">xmin =</span> top_left_x , <span class="dt">xmax =</span>  top_left_x <span class="op">+</span><span class="st"> </span>width, </a>
<a class="sourceLine" id="cb5-7" data-line-number="7">                 <span class="dt">ymin =</span> top_left_y, <span class="dt">ymax =</span> top_left_y <span class="op">+</span><span class="st"> </span>height, </a>
<a class="sourceLine" id="cb5-8" data-line-number="8">                 <span class="dt">color =</span> <span class="kw">factor</span>(face_id)),</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">             <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">linetype =</span> <span class="st">'dashed'</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="st">   </span><span class="kw">geom_label</span>(<span class="dt">data =</span> sw_faces,</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">             <span class="kw">aes</span>(<span class="dt">x =</span> chin_tip_x, <span class="dt">y =</span> chin_tip_y <span class="op">+</span><span class="st"> </span><span class="dv">15</span>, </a>
<a class="sourceLine" id="cb5-12" data-line-number="12">                 <span class="dt">label =</span> face_gender_type,</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">                 <span class="dt">color =</span> <span class="kw">factor</span>(face_id)), <span class="dt">size =</span> <span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="st">   </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"none"</span>)</a></code></pre></div>
<p><img src="../man/figures/sw_facerec.png" width="400"></p>
<p>Besides annotating faces in single images, it is possible to permanently store face recognition data with the Kairos API. This allows to assign multiple images to subject ids and estimates about whether faces from different images belong to the same subjects:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">finn_face &lt;-<span class="st"> </span><span class="kw"><a href="../reference/enroll.html">enroll</a></span>(<span class="dt">image =</span> finn_image, </a>
<a class="sourceLine" id="cb6-2" data-line-number="2">                    <span class="dt">subject_id =</span> <span class="st">'finn'</span>, <span class="dt">gallery =</span> <span class="st">'starwars'</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">finn_new &lt;-<span class="st"> 'https://upload.wikimedia.org/wikipedia/commons/b/b6/John_Boyega_by_Gage_Skidmore.jpg'</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">finn_rec &lt;-<span class="st"> </span><span class="kw"><a href="../reference/recognize.html">recognize</a></span>(<span class="dt">image =</span> finn_new, <span class="dt">gallery =</span> <span class="st">'starwars'</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">                      <span class="dt">show_candidate_images =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>The function <code><a href="../reference/recognize.html">recognize()</a></code> returns a dataframe including the probability of a match in the column <code>confidence</code>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#an-interface-for-face-recognition-in-r">An Interface for Face Recognition in R</a><ul class="nav nav-pills nav-stacked">
<li><a href="#how-to-install">How to Install</a></li>
      <li><a href="#how-to-use">How to Use</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.carstenschwemmer.com">Carsten Schwemmer</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
